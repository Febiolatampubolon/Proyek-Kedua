import{C as s}from"./index-SvUnOQRe.js";function a(n){const e="=".repeat((4-n.length%4)%4),r=(n+e).replace(/-/g,"+").replace(/_/g,"/"),t=atob(r),i=new Uint8Array(t.length);for(let o=0;o<t.length;++o)i[o]=t.charCodeAt(o);return i}async function p(){if(!("serviceWorker"in navigator))throw new Error("Service worker not supported");if(await Notification.requestPermission()!=="granted")throw new Error("Notification permission denied");const r=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:a(s.VAPID_PUBLIC_KEY)}),t=localStorage.getItem("token");if(!t)throw new Error("Login required");const i={endpoint:r.endpoint,keys:r.toJSON().keys};return await(await fetch(`${s.BASE_URL}/notifications/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(i)})).json()}async function g(){const e=await(await navigator.serviceWorker.ready).pushManager.getSubscription();if(!e)return{error:!1};const r=localStorage.getItem("token");if(!r)throw new Error("Login required");return await e.unsubscribe(),await(await fetch(`${s.BASE_URL}/notifications/subscribe`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({endpoint:e.endpoint})})).json()}async function b(){return!!await(await navigator.serviceWorker.ready).pushManager.getSubscription()}export{b as isSubscribed,p as subscribePush,g as unsubscribePush};
